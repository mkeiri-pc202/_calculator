# 電卓プログラム 仕様書（テンプレート）

バージョン: 0.1  
作成日: [YYYY-MM-DD]  
作成者: [作成者名 / GitHub アカウント]  
リポジトリ: [mkeiri-pc202/_calculator](https://github.com/mkeiri-pc202/_calculator)

---

## 1. 概要
この文書は、電卓プログラムの設計・要件・受け入れ基準を定義する仕様書のテンプレートです。対象はデスクトップ／コマンドライン／ウェブ等、実装形態に応じて適宜編集してください。

### 1.1 目的
- プロダクトおよび実装チーム間での共通理解を作る。
- 要件を明確化し、テスト項目と受け入れ基準を定義する。

### 1.2 範囲
- 提供する機能（基本四則演算、追加機能、入出力形式など）
- ユーザーインターフェース（UI/CLI/API）
- 想定しない事項（非対応の機能）

---

## 2. 用語定義
- 演算子: +, -, ×, ÷ など
- トークン: 字句解析で扱う最小単位
- 評価器（Evaluator）: 抽象構文木 (AST) を走査して結果を計算するモジュール
- 精度: 小数点以下の扱いに関する定義（例: IEEE754, fixed-point）

---

## 3. 高レベル要件（目的・目標）
- 正確さ: 標準的な数値表現で正しい結果を返すこと
- 応答性: 単一計算は 100ms 未満で完了（目安）
- 耐久性: 異常入力に対して適切なエラーメッセージを返すこと
- 国際化（必要であれば）: 小数点・カンマ区切りのローカライズ対応

---

## 4. 機能要件

### 4.1 基本機能（必須）
- 加算 (a + b)
- 減算 (a - b)
- 乗算 (a * b)
- 除算 (a / b) — 0 除算時の挙動を定義する
- 小数の取り扱い
- 正負（負数）の入力と計算
- 演算子優先順位（乗除が加減より優先）
- 括弧によるグルーピング ( )

### 4.2 追加機能（任意／優先度をつける）
- 累乗（^ または pow）
- ルート（sqrt）
- 統計関数（平均、合計など）
- メモリ機能（M+, M-, MR, MC）
- 履歴（過去の計算と結果の参照）
- 文字列入力（例: "2+3*4" の解析）
- コマンドライン引数による一括計算
- ウェブ／GUI 版のボタン操作

### 4.3 非機能要件
- 精度: 倍精度浮動小数点（double）または任意精度ライブラリを使用
- パフォーマンス: 単一式評価は高速に（目標値をプロジェクトで設定）
- セキュリティ: 外部式評価（例：eval の直接使用）を避ける
- 可用性: ライブラリ依存を最小化
- テスト容易性: モジュールごとにユニットテストを用意

---

## 5. ユーザーインターフェース（UI / UX）
（該当する実装形態のセクションを残し、不要な項目は削除）

### 5.1 コマンドライン (CLI)
- 起動方法: `calculator [式]`
- インタラクティブモード: REPL サポート（例: プロンプトが表示される）
- 引数: `--precision`, `--history`, `--format=json` など

### 5.2 GUI / Web
- 表示要素: 入力欄、結果表示、履歴パネル、メモリボタン
- キーボード操作: Enterで確定、Escでクリア、Backspace で一文字削除
- アクセシビリティ: フォーカス順、スクリーンリーダー対応

### 5.3 API（ライブラリとして提供する場合）
- 公開関数例:
  - evaluate(expression: string): number | Error
  - parse(expression: string): AST
  - format(number, options): string

---

## 6. 入出力仕様

### 6.1 入力形式
- 文字列式（例: "3 + 4 * (2 - 1)"）
- 数値（引数で直接数値を与える場合）
- 実数表現のルール（小数点記号、指数表記の可否）

### 6.2 出力形式
- デフォルト: 数値（例: 7）
- オプション: JSON（{ "expression": "...", "result": 7 }）
- エラー時: 明確なエラーコードとメッセージ

---

## 7. エラー処理とメッセージ
- 構文エラー: "SyntaxError: 不正な式です（位置: N）"
- 0 除算: "MathError: 0 で除算しました"
- 値オーバーフロー/アンダーフロー: "RangeError: 値が範囲外です"
- 未定義シンボル: "NameError: 未知の識別子 'x' が使用されています"
- API の場合は例外／エラーコード仕様を明記する

---

## 8. 例（ユースケース）
- 入力: "2+3*4" → 出力: 14
- 入力: "(1+2)/3" → 出力: 1
- 入力: "10 / 0" → 出力: エラー (0 除算)
- CLI: `calculator "sqrt(9) + 1"` → 出力: 4

---

## 9. 内部設計（アーキテクチャ）
- 層構成:
  - プレゼンテーション層（UI / CLI）
  - コントローラ（入力を解析して評価器へ渡す）
  - コア（字句解析 Lexer, 構文解析 Parser, 評価器 Evaluator）
  - 永続層（履歴保存：ファイル、ローカルストレージ等）
- モジュール分割（例）
  - src/lexer.*
  - src/parser.*
  - src/evaluator.*
  - src/ui.*
  - src/cli.*
  - tests/

### 9.1 データフロー（簡易）
入力 → Lexer（トークン化）→ Parser（AST）→ Evaluator（計算）→ 出力表示

---

## 10. テスト計画
- ユニットテスト
  - Lexer: トークン化の網羅テスト
  - Parser: 構文ツリー生成テスト
  - Evaluator: 演算の正しさテスト（境界値含む）
- 統合テスト
  - 複雑な式の評価（ネスト・優先順位の確認）
- 回帰テスト
  - 既知の不具合を防ぐテストケース
- 自動テスト実行コマンド例:
  - `npm test` / `pytest` / `go test` 等

テストデータ例:
- 正常系: "3+5", "2*(3+4)", "1.5+2.25"
- 異常系: ")", "2++2", "10/0"

---

## 11. 受け入れ基準
- 定義された基本機能が全て正常に動作すること
- テストスイートが全てパスすること
- 重大なエラー（クラッシュ、未処理例外）がないこと
- ドキュメント（README, 仕様書）が整備されていること

---

## 12. ロードマップ / バージョニング
- v0.1: 基本四則 + 小数 + CLI
- v0.2: 括弧、履歴、メモリ機能
- v1.0: GUI/ウェブ版、国際化、安定リリース

---

## 13. ビルド・実行方法（テンプレート）
- 要求環境: [言語/バージョン例]
- ビルド:
  - 例: `make build` / `go build ./...` / `npm run build`
- 実行:
  - CLI: `./calculator "2+3"`
  - REPL: `./calculator` → プロンプトで式を入力
- テスト:
  - `make test` / `npm test` / `pytest`

---

## 14. 依存関係
- ランタイム / 言語バージョン
- 使用ライブラリ（例: big-decimal、mathjs 等）

---

## 15. セキュリティと注意点
- 入力式をそのまま eval に流用しない
- 外部からの式評価時にコマンド実行が起きないよう完全に分離する

---

## 16. 付録
- 変更履歴（Changelog）
- 既知の制限／既知のバグ
- 参考資料（演算子優先順位表、IEEE754）
- 担当者一覧 / 連絡先

---

## 17. TODO（テンプレート）
- [ ] 精度要件の確定（float vs decimal）
- [ ] ローカライズ対応の方針決定
- [ ] GUI ワイヤーフレーム作成
- [ ] CI での自動テスト導入

---

（終わり）
