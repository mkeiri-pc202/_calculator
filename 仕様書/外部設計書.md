# 電卓プログラム 外部設計書

バージョン: 1.0  
最終更新日: [2025/11/06]  
作成者: [作成者名 / 松本経理ビジネス専門学校 Team A ]  
リポジトリ: [mkeiri-pc202/_calculator](https://github.com/mkeiri-pc202/_calculator)

---

## 1.アプリ概要
本アプリは、PythonのTkinterを用いて構築したGUI電卓である。基本の四則演算に加えて、累乗や平方根、指数表記など多彩な演算機能を備えている。
ユーザーは画面上のボタン入力と物理キーボード入力、両方から入力ができ、入力制御により、不正な文字や演算子の連続入力などを防ぐ。
計算処理は文字列をコードとして扱えるeval関数や数式処理のsympyライブラリではなく、独自の数式処理プログラムkeisai.pyで評価を行う。

## 2.画面仕様
アプリ起動時にタイトル「電卓」が左上に表示されたウィンドウが表示される。
サイズは固定で横310ピクセル、縦415ピクセルで表示され、最大化・最小化のリサイズは不可。
画面上部には計算式や計算結果を表示するテキストボックスが配置され、右詰めで表示される。
テキストボックスは表示専用で、直接入力はできない。
画面下部にはボタンを4列×6行で配置し、数字や演算子、平方根や指数表記等の特殊機能を選択できる。

## 3.入力仕様
ユーザーはGUIアプリのボタンか物理キーボード入力で文字を入力し、数式を構築する。
### 3.1ボタン入力
ボタン入力では以下のボタンが入力可能である。
1, 2, 3, 4, 5, 6, 7, 8, 9, 0, +, -, ×, ÷, =, ., C, %, √(平方根), ^(累乗), ±(プラスマイナス), E(指数表記)
### 3.2キーボード入力
キーボード入力では上記のボタン入力の数字、記号と紐づくキーで入力が可能である。
また、Enterキーで=(計算実行)と同じ動作、BackSpaceキーで末尾の文字を1文字消すことが可能である。

## 4.出力仕様
### 4.1計算結果
計算結果はkeisan.pyの「全体計算」関数によって評価される。
### 4.2エラー表示
計算不能な場合や不正な入力があった場合は「エラー」と表示される。

## 5.機能仕様
本アプリは以下の演算機能と入力制御機能を提供する。
### 5.1演算機能
- 四則演算(+, -, ×, ÷)
- パーセント(%)
- 平方根(√)
- 累乗(^)
- プラスマイナス切替(±)
- 指数表記(E)
なお、パーセントの機能は%入力前の数字に÷100を行う機能とする。
### 5.2入力制御
- 入力許可文字(3.1ボタン入力参照)以外は入力不可とする。
- 演算子の連続入力は不可とする。
- 空括弧も入力不可とする。
- 括弧が不足している状態で計算実行(=)を行った場合は自動補完して結果が出るようにする。
- 数字もしくは後括弧が末尾に入力されている状態で、前括弧入力を行った場合、自動的に×(*)も併せて表示する。

## 6.エラー仕様
本アプリは以下のエラーに対応する。画面上には「エラー」と表示する。
### 6.1入力エラー
- 演算子の連続入力
- 空括弧()
- 不正文字
### 6.2出力エラー
- ゼロ除算
- 負数の非整数累乗による虚数
- オーバーフロー

## 7.操作フロー
ユーザーが入力を行うと、その文字は input_handler.py の handle_input 関数に渡される。
handle_input関数では入力の補正や特殊処理が行われ、数式が keisan.py に渡される。
keisan.py では数式補正、字句解析、逆ポーランド変換を経て計算が実行される。
結果は utils.py の format_result 関数でエラー判定を行い、画面に表示される。
![alt text](sequence_dentaku.png)

## 8.非機能要件
本アプリは単体で動作し、外部ライブラリへの依存はない。
GUI、入力処理、計算部を分離して構築しており、保守性の担保や機能の追加・変更も容易に行えるようにする。

## 9.終わり
- 