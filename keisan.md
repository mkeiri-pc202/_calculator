モジュール keisan.py の内部について

クラス　class文字計算

 def __init__(self, name, 入力文字式, 補正入力文字式, 字句解析リスト, 逆ポーランドリスト, 計算結果文字,err):

属性　   name              :インスタンス名
　　　　 入力文字式         :GIから入力された文字式 '(-1)(2+3)
        補正入力文字式      :補正　'(0-1)*(2+3)'
        字句解析リスト      :各字句を、要素として、リスト化したもの。[ , , ・・・・]
        逆ポーランドリスト  :逆ポーランド法にリスト化したもの。      [ , , ・・・・]
        計算結果文字        :逆ポーランド法から計算した結果         [ ]
        err                :エラーがあれば。 例えば 'エラー　ゼロの割り算です'

メソッドの構成　と使用する関数
    前の属性から、次の属性を算出するために、メソッドを作りました。
    関数を呼び出して、作業しています。

        ・メソッド_文字式補正　⇒　関数_文字補正式
        ・メソッド_字句解析    ⇒  関数_字句取り出し
        ・メソッド_逆ポーランド⇒  関数_逆ポーランド
        ・メソッド_計算        ⇒ 関数_計算/関数_部分計算(Decimal使用)

その他の補助的な関数
        ・関数_丸め誤差除去　　表記をきれいにします
        ・関数_演算子優先度　　数値も含めて、演算子の優先順位を決めます
        ・関数_数値か判定      要素が数値か否かを判定します。
    
詳細
    ・字句解析の方法
        文字式の先頭から、１字ずつ取り出し、リストの要素に入れる。
        数値の場合は、まとめて、１つの要素に入れる。
    ・逆ポーランド整列の方法
        字句リストから１要素ずつ取り出して、前の要素と比較して、ポーランドリストに追加していく。
        要素には、優先順位があり、優先順位が高い場合は、手前に入れる。
        （　がある場合は、再帰で逆ポーランド配列を呼び出して、）で戻る
    ・計算方法
        逆ポーランドのリストから、１要素ずつ取り出して、演算子がきたら、手前の２つの要素と演算する。結果を、演算子の位置に入れて、前の要素２つを削除する。
        これを繰り返すと、最後に計算結果だけがリストに残る。

簡単な例

    入力         '√√16E4'

    入力文字補正  '√√16E4'

    字句解析       ['√', '√', '16', 'E','4']

    逆ポーランド　　['√']                               :左から１要素取り出す
                   ['√', '√']
                   ['16', '√', '√']                    :数値は最も優先順位が高いので左に入れる
                   ['16', 'E', '√', '√']               :E は数値の次に優先順位が高い
                   ['16', '4', 'E', '√', '√'] 　        :数値はEよりも優先順位が高い
                   ['16', '4', 'E', '0.5', '**', '0.5', '**'] :√を0.5**に替える
   
    計算           ['16E4','0.5', '**', '0.5', '**']
                   ['400.0000000000000000000000000', '0.5', '**']　←Decimalを使ったために、小数点以下の桁数が増えている
                　 ['20.00000000000000000000000000']

    整形            '20'　←　小数点と小数点以下の　0　を削除

ちょっと複雑な例

    入力         '√√16E-4'
    入力補正     '√√16E(0-1)~4' :-4を(0-1)~4とした。~は*の優先順位を上げた演算子。
    字句解析     ['√', '√', '16', 'E', '(', '0', '-', '1', ')', '~', '4']
    逆ポーランド  ['16', '0', '1', '-', '4', '~', 'E', '0.5', '**', '0.5', '**'] : ( ) 内は、( )外に影響されない
    計算結果　　　['0.2000000000000000000000000000']
    整形         '0.2'

残りの課題　よりスマートなやり方(宮内さんのアドバイス)

 1. 逆ポーランド法に替えて、二分木を使う（両者は等価）
    演算子の優先順位は、数値 > () > */ > +- 
    優先順位が高い場合、子になる。同じなら、親になる。

    例
    　1+2+3
                                +         +
                               /         /  \
              +      +        +         +     3
             /      /  \     /  \      /  \
        1   1      1    2   1    2    1    2
            
    1+2*3                                           (1+2)*3
                                                                            *       *
                                                                           /       /  \
              +     +        +        +                   +      +        +       +    3
             /     /  \     /  \     /  \                /      /  \     /  \    /  \
        1   1     1    2   1    *   1    *          1   1      1    2   1    2  1    2
                               /        /  \
                              2        2    3
 2.二分木を用いた計算
    根から、節を伝って、葉が現れたら、計算して、結果を演算子と交換し、葉を消す
    これを、再帰で繰り返す。

    データ例                                    計算例 (1+2)*3

    クラスにして(よく見た、あの構造)
    
    ・アドレス
    ・数値も含めての、演算子の優先順位                    *               *         (3*3=) 9
    ・値                                              /  \            /  \             /  \
    ・親のアドレス                                    +    3    (1+2=)3    3           -    -
    ・左側の子のアドレス                             /  \            /  \
    ・右側の子のアドレス                            1    2          -    -

    あるいは、リストにする

プログラムにするをことが、やり残したことです。